import{b as B,j as b,k as L}from"./api-ZxrN8FjE.js";import{F as S}from"./Footer-DnPTH6_A.js";const C=document.getElementById("product-form"),w=document.getElementById("img-input"),p=document.getElementById("preview-img"),v=document.getElementById("upload-icon"),g=document.querySelectorAll(".shipping-btn"),D=document.getElementById("footer");new S(D);let m="PARCEL",f=!1,i=null,y=!1,d=null;document.addEventListener("DOMContentLoaded",async()=>{const o=new URLSearchParams(window.location.search);i=o.get("id"),o.get("mode")==="copy"&&i?(y=!0,document.title="상품 복사 등록 | HODU Seller",document.querySelector(".page-title").textContent="상품 복사 등록",document.querySelector(".save-btn").textContent="저장하기",await h(i),i=null):i&&(f=!0,document.title="상품 수정 | HODU Seller",document.querySelector(".page-title").textContent="상품 수정",document.querySelector(".save-btn").textContent="수정하기",await h(i))});async function h(o){try{const e=await B(o),c=e.product_name||e.name,s=e.product_info||e.products_info||e.info;if(document.getElementById("product-name").value=c,document.getElementById("price").value=e.price,document.getElementById("shipping-fee").value=e.shipping_fee,document.getElementById("stock").value=e.stock,document.getElementById("product-info").value=s,m=e.shipping_method,g.forEach(a=>{a.dataset.method===m?a.classList.add("active"):a.classList.remove("active")}),e.image){const a=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";let n=e.image;if(a?(n=e.image.replace("https://api.wenivops.co.kr","/proxy"),n=n.replace("http://api.wenivops.co.kr","/proxy")):n.startsWith("http:")&&(n=n.replace("http:","https:")),p.src=n,p.style.display="block",v.style.display="none",document.querySelector(".img-placeholder").style.backgroundColor="transparent",y&&a)try{const l=await fetch(n);if(!l.ok)throw new Error("이미지 다운로드 실패");const t=await l.blob(),r=e.image.split("/").pop()||"image.jpg";d=new File([t],r,{type:t.type})}catch{alert("이미지 변환 중 오류가 발생했습니다. 수동으로 등록해주세요.")}}}catch{alert("상품 정보를 불러오는 데 실패했습니다."),window.history.back()}}w.addEventListener("change",o=>{const e=o.target.files[0];if(e){const c=new FileReader;c.onload=s=>{p.src=s.target.result,p.style.display="block",v.style.display="none",document.querySelector(".img-placeholder").style.backgroundColor="transparent"},c.readAsDataURL(e)}});g.forEach(o=>{o.addEventListener("click",()=>{g.forEach(e=>e.classList.remove("active")),o.classList.add("active"),m=o.dataset.method})});C.addEventListener("submit",async o=>{o.preventDefault();const e=document.getElementById("product-name").value,c=document.getElementById("price").value,s=document.getElementById("shipping-fee").value,a=document.getElementById("stock").value,n=document.getElementById("product-info").value,l=w.files[0];if(!f&&!l&&!d)return alert("상품 이미지를 등록해주세요!");if(!e||!c||!s||!a||!n)return alert("모든 정보를 입력해주세요.");const t=new FormData;t.append("name",e),t.append("price",parseInt(c)),t.append("shipping_method",m),t.append("shipping_fee",parseInt(s)),t.append("stock",parseInt(a)),t.append("info",n),l?t.append("image",l):y&&d&&t.append("image",d);try{let r;f?(r=await b(i,t),alert("상품이 성공적으로 수정되었습니다.")):(r=await L(t),alert("상품이 성공적으로 등록되었습니다.")),window.location.href="/openMarket/src/pages/seller-center/index.html"}catch(r){if(r.data){const E=Object.entries(r.data).map(([I,u])=>{const k=Array.isArray(u)?u.join(", "):u;return`[${I}] ${k}`}).join(`
`);alert(`처리 실패:
${E}`)}else r.detail?alert(r.detail):alert("알 수 없는 오류가 발생했습니다. 다시 시도해주세요.")}});document.querySelector(".cancel-btn").addEventListener("click",()=>{confirm("작성 중인 내용이 사라집니다. 취소하시겠습니까?")&&window.history.back()});
