import{b as B,k as b,m as L}from"./api-BjdzUVpJ.js";import{F as S}from"./Footer-DnPTH6_A.js";const C=document.getElementById("product-form"),w=document.getElementById("img-input"),p=document.getElementById("preview-img"),v=document.getElementById("upload-icon"),g=document.querySelectorAll(".shipping-btn"),D=document.getElementById("footer");new S(D);let m="PARCEL",f=!1,i=null,y=!1,d=null;document.addEventListener("DOMContentLoaded",async()=>{const o=new URLSearchParams(window.location.search);i=o.get("id"),o.get("mode")==="copy"&&i?(y=!0,document.title="상품 복사 등록 | HODU Seller",document.querySelector(".page-title").textContent="상품 복사 등록",document.querySelector(".save-btn").textContent="저장하기",await h(i),i=null):i&&(f=!0,document.title="상품 수정 | HODU Seller",document.querySelector(".page-title").textContent="상품 수정",document.querySelector(".save-btn").textContent="수정하기",await h(i))});async function h(o){try{const e=await B(o),l=e.product_name||e.name,s=e.product_info||e.products_info||e.info;if(document.getElementById("product-name").value=l,document.getElementById("price").value=e.price,document.getElementById("shipping-fee").value=e.shipping_fee,document.getElementById("stock").value=e.stock,document.getElementById("product-info").value=s,m=e.shipping_method,g.forEach(r=>{r.dataset.method===m?r.classList.add("active"):r.classList.remove("active")}),e.image){const r=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";let n=e.image;if(r?(n=e.image.replace("https://api.wenivops.co.kr","/proxy"),n=n.replace("http://api.wenivops.co.kr","/proxy")):n.startsWith("http:")&&(n=n.replace("http:","https:")),p.src=n,p.style.display="block",v.style.display="none",document.querySelector(".img-placeholder").style.backgroundColor="transparent",y)if(r)try{const c=await fetch(n);if(!c.ok)throw new Error("이미지 다운로드 실패");const t=await c.blob(),a=e.image.split("/").pop()||"image.jpg";d=new File([t],a,{type:t.type}),console.log("이미지 변환 성공:",d)}catch(c){console.error("이미지 변환 실패 (네트워크 오류):",c),alert("이미지 변환 중 오류가 발생했습니다. 수동으로 등록해주세요.")}else console.log("배포 환경: 이미지 자동 패치 건너뜀 (CORS 회피)")}}catch(e){console.error("상품 정보 로드 실패",e),alert("상품 정보를 불러오는 데 실패했습니다."),window.history.back()}}w.addEventListener("change",o=>{const e=o.target.files[0];if(e){const l=new FileReader;l.onload=s=>{p.src=s.target.result,p.style.display="block",v.style.display="none",document.querySelector(".img-placeholder").style.backgroundColor="transparent"},l.readAsDataURL(e)}});g.forEach(o=>{o.addEventListener("click",()=>{g.forEach(e=>e.classList.remove("active")),o.classList.add("active"),m=o.dataset.method})});C.addEventListener("submit",async o=>{o.preventDefault();const e=document.getElementById("product-name").value,l=document.getElementById("price").value,s=document.getElementById("shipping-fee").value,r=document.getElementById("stock").value,n=document.getElementById("product-info").value,c=w.files[0];if(!f&&!c&&!d)return alert("상품 이미지를 등록해주세요!");if(!e||!l||!s||!r||!n)return alert("모든 정보를 입력해주세요.");const t=new FormData;t.append("name",e),t.append("price",parseInt(l)),t.append("shipping_method",m),t.append("shipping_fee",parseInt(s)),t.append("stock",parseInt(r)),t.append("info",n),c?t.append("image",c):y&&d&&t.append("image",d);try{let a;f?(a=await b(i,t),alert("상품이 성공적으로 수정되었습니다.")):(a=await L(t),alert("상품이 성공적으로 등록되었습니다.")),console.log("처리 성공:",a),window.location.href="/openMarket/src/pages/seller-center/index.html"}catch(a){if(console.error(a),a.data){const E=Object.entries(a.data).map(([I,u])=>{const k=Array.isArray(u)?u.join(", "):u;return`[${I}] ${k}`}).join(`
`);alert(`처리 실패:
${E}`)}else a.detail?alert(a.detail):alert("알 수 없는 오류가 발생했습니다. 다시 시도해주세요.")}});document.querySelector(".cancel-btn").addEventListener("click",()=>{confirm("작성 중인 내용이 사라집니다. 취소하시겠습니까?")&&window.history.back()});
