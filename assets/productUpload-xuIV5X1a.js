import{b as k,k as b,m as L}from"./api-BjdzUVpJ.js";import{F as S}from"./Footer-DnPTH6_A.js";const C=document.getElementById("product-form"),v=document.getElementById("img-input"),p=document.getElementById("preview-img"),E=document.getElementById("upload-icon"),g=document.querySelectorAll(".shipping-btn"),D=document.getElementById("footer");new S(D);let m="PARCEL",f=!1,c=null,y=!1,d=null;document.addEventListener("DOMContentLoaded",async()=>{const t=new URLSearchParams(window.location.search);c=t.get("id"),t.get("mode")==="copy"&&c?(y=!0,document.title="상품 복사 등록 | HODU Seller",document.querySelector(".page-title").textContent="상품 복사 등록",document.querySelector(".save-btn").textContent="저장하기",await h(c),c=null):c&&(f=!0,document.title="상품 수정 | HODU Seller",document.querySelector(".page-title").textContent="상품 수정",document.querySelector(".save-btn").textContent="수정하기",await h(c))});async function h(t){try{const e=await k(t),r=e.product_name||e.name,l=e.product_info||e.products_info||e.info;if(document.getElementById("product-name").value=r,document.getElementById("price").value=e.price,document.getElementById("shipping-fee").value=e.shipping_fee,document.getElementById("stock").value=e.stock,document.getElementById("product-info").value=l,m=e.shipping_method,g.forEach(n=>{n.dataset.method===m?n.classList.add("active"):n.classList.remove("active")}),e.image&&(p.src=e.image,p.style.display="block",E.style.display="none",document.querySelector(".img-placeholder").style.backgroundColor="transparent",y))try{const i=await(await fetch(e.image)).blob(),s=e.image.split("/").pop()||"image.jpg";d=new File([i],s,{type:i.type}),console.log("이미지 변환 성공:",d)}catch(n){console.error("이미지 변환 실패:",n),alert("기존 이미지를 불러오는 데 실패했습니다. 이미지를 다시 등록해주세요.")}}catch(e){console.error("상품 정보 로드 실패",e),alert("상품 정보를 불러오는 데 실패했습니다."),window.history.back()}}v.addEventListener("change",t=>{const e=t.target.files[0];if(e){const r=new FileReader;r.onload=l=>{p.src=l.target.result,p.style.display="block",E.style.display="none",document.querySelector(".img-placeholder").style.backgroundColor="transparent"},r.readAsDataURL(e)}});g.forEach(t=>{t.addEventListener("click",()=>{g.forEach(e=>e.classList.remove("active")),t.classList.add("active"),m=t.dataset.method})});C.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("product-name").value,r=document.getElementById("price").value,l=document.getElementById("shipping-fee").value,n=document.getElementById("stock").value,i=document.getElementById("product-info").value,s=v.files[0];if(!f&&!s&&!d)return alert("상품 이미지를 등록해주세요!");if(!e||!r||!l||!n||!i)return alert("모든 정보를 입력해주세요.");const o=new FormData;o.append("name",e),o.append("price",parseInt(r)),o.append("shipping_method",m),o.append("shipping_fee",parseInt(l)),o.append("stock",parseInt(n)),o.append("info",i),s?o.append("image",s):y&&d&&o.append("image",d);try{let a;f?(a=await b(c,o),alert("상품이 성공적으로 수정되었습니다.")):(a=await L(o),alert("상품이 성공적으로 등록되었습니다.")),console.log("처리 성공:",a),window.location.href="/openMarket/src/pages/seller-center/index.html"}catch(a){if(console.error(a),a.data){const I=Object.entries(a.data).map(([w,u])=>{const B=Array.isArray(u)?u.join(", "):u;return`[${w}] ${B}`}).join(`
`);alert(`처리 실패:
${I}`)}else a.detail?alert(a.detail):alert("알 수 없는 오류가 발생했습니다. 다시 시도해주세요.")}});document.querySelector(".cancel-btn").addEventListener("click",()=>{confirm("작성 중인 내용이 사라집니다. 취소하시겠습니까?")&&window.history.back()});
