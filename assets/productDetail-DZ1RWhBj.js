import{g as x,b as B,d as L}from"./api-CVDx6PwF.js";import{b as S,c as v}from"./Modal-CoTgg4te.js";import{H as T}from"./Header-Bwznhzs6.js";import{F as P}from"./Footer-DnPTH6_A.js";const p=document.getElementById("productImage"),q=document.getElementById("sellerName"),M=document.getElementById("productName"),_=document.getElementById("productPrice"),D=document.getElementById("shippingInfo"),s=document.getElementById("minusBtn"),d=document.getElementById("plusBtn"),g=document.getElementById("quantity"),h=document.getElementById("totalQuantity"),k=document.getElementById("totalPrice"),a=document.querySelector(".buy"),i=document.querySelector(".cart"),f=document.querySelectorAll(".tab");let r=null,o=1;document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search).get("productId");if(!e){alert("잘못된 접근입니다."),history.back();return}const n=document.querySelector("#header");n&&new T(n);const c=document.querySelector("#footer");c&&new P(c),A(e)});async function A(t){try{const e=await x(t);console.log("get products/id",e),r=e,N(e),R()}catch(e){console.error("Error loading product:",e),alert("상품 정보를 불러오는 데 실패했습니다.")}}function N(t){console.log(t);const{image:e,name:n,price:c,seller:m,shipping_method:E,shipping_fee:y,stock:I}=t;p.src=e,p.alt=n,q.textContent=m.store_name||m.name,M.textContent=n,_.textContent=u(c);const b=E==="PARCEL"?"택배배송":"직접배송",w=y===0?"무료배송":`${u(y)}원`;D.textContent=`${b} / ${w}`,I===0?F():l(),$()}function $(){localStorage.getItem("userType")==="SELLER"&&(a.disabled=!0,i.disabled=!0,s.disabled=!0,d.disabled=!0,a.style.backgroundColor="#ccc",a.textContent="판매자 구매 불가",a.style.cursor="not-allowed",i.style.backgroundColor="#eee",i.style.cursor="not-allowed",s.style.opacity="0.3",d.style.opacity="0.3")}function R(){!r||r.stock===0||(s.addEventListener("click",()=>{o>1&&(o--,l())}),d.addEventListener("click",()=>{o<r.stock?(o++,l()):alert("최대 구매 가능 수량입니다.")}),a.addEventListener("click",()=>{if(!C())return;const t={order_kind:"direct_order",product_id:r.id,quantity:o};localStorage.setItem("order_data",JSON.stringify(t)),window.location.href="/openMarket/src/pages/payment/index.html"}),i.addEventListener("click",O),f.forEach(t=>{t.addEventListener("click",e=>{f.forEach(n=>n.classList.remove("active")),e.target.classList.add("active")})}))}function C(){return localStorage.getItem("token")?!0:(S(),!1)}function l(){const t=r.stock;g.textContent=o,h.textContent=o;const e=r.price*o;k.textContent=u(e),s.disabled=o<=1,s.style.opacity=o<=1?"0.3":"1";const n=o>=t;d.disabled=n,d.style.opacity=n?"0.3":"1"}function F(){o=0,g.textContent="0",h.textContent="0",k.textContent="0",a.textContent="품절",a.disabled=!0,i.disabled=!0,s.disabled=!0,d.disabled=!0}async function O(){if(C())try{const t=await B();if(console.log(t.results[0]),console.log(r.id),t.results.some(c=>c.product.id===r.id)){await v({message:"이미 장바구니에 있는 상품입니다.<br>장바구니로 이동하시겠습니까?",confirmText:"예",cancelText:"아니오"})&&(window.location.href="/openMarket/src/pages/cart/index.html");return}await L({product_id:r.id,quantity:o,check:!0}),confirm(`장바구니에 상품을 담았습니다.
장바구니 페이지로 이동하시겠습니까?`)&&(window.location.href="/openMarket/src/pages/cart/index.html")}catch(t){console.error("장바구니 처리 중 오류:",t),alert("문제가 발생했습니다. 다시 시도해 주세요.")}}function u(t){return new Intl.NumberFormat("ko-KR").format(t)}
