import{b as x,d as B,e as L}from"./api-ZxrN8FjE.js";import{b as S,c as v}from"./Modal-paOObtiz.js";import{H as T}from"./Header-CEUy6QMe.js";import{F as P}from"./Footer-DnPTH6_A.js";const y=document.getElementById("productImage"),D=document.getElementById("sellerName"),M=document.getElementById("productName"),q=document.getElementById("productPrice"),_=document.getElementById("shippingInfo"),s=document.getElementById("minusBtn"),d=document.getElementById("plusBtn"),g=document.getElementById("quantity"),h=document.getElementById("totalQuantity"),k=document.getElementById("totalPrice"),c=document.querySelector(".buy"),i=document.querySelector(".cart"),f=document.querySelectorAll(".tab");let r=null,o=1;document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search).get("productId");if(!e){alert("잘못된 접근입니다."),history.back();return}const n=document.querySelector("#header");n&&new T(n);const a=document.querySelector("#footer");a&&new P(a),$(e)});async function $(t){try{const e=await x(t);r=e,A(e),R()}catch{alert("상품 정보를 불러오는 데 실패했습니다.")}}function A(t){const{image:e,name:n,price:a,seller:m,shipping_method:C,shipping_fee:p,stock:E}=t;y.src=e,y.alt=n,D.textContent=m.store_name||m.name,M.textContent=n,q.textContent=u(a);const I=C==="PARCEL"?"택배배송":"직접배송",b=p===0?"무료배송":`${u(p)}원`;_.textContent=`${I} / ${b}`,E===0?F():l(),N()}function N(){localStorage.getItem("userType")==="SELLER"&&(c.disabled=!0,i.disabled=!0,s.disabled=!0,d.disabled=!0,c.style.backgroundColor="#ccc",c.textContent="판매자 구매 불가",c.style.cursor="not-allowed",i.style.backgroundColor="#eee",i.style.cursor="not-allowed",s.style.opacity="0.3",d.style.opacity="0.3")}function R(){!r||r.stock===0||(s.addEventListener("click",()=>{o>1&&(o--,l())}),d.addEventListener("click",()=>{o<r.stock?(o++,l()):alert("최대 구매 가능 수량입니다.")}),c.addEventListener("click",()=>{if(!w())return;const t={order_kind:"direct_order",product_id:r.id,quantity:o};localStorage.setItem("order_data",JSON.stringify(t)),window.location.href="/openMarket/src/pages/payment/"}),i.addEventListener("click",O),f.forEach(t=>{t.addEventListener("click",e=>{f.forEach(n=>n.classList.remove("active")),e.target.classList.add("active")})}))}function w(){return localStorage.getItem("token")?!0:(S(),!1)}function l(){const t=r.stock;g.textContent=o,h.textContent=o;const e=r.price*o;k.textContent=u(e),s.disabled=o<=1,s.style.opacity=o<=1?"0.3":"1";const n=o>=t;d.disabled=n,d.style.opacity=n?"0.3":"1"}function F(){o=0,g.textContent="0",h.textContent="0",k.textContent="0",c.textContent="품절",c.disabled=!0,i.disabled=!0,s.disabled=!0,d.disabled=!0}async function O(){if(w())try{if((await B()).results.some(a=>a.product.id===r.id)){await v({message:"이미 장바구니에 있는 상품입니다.<br>장바구니로 이동하시겠습니까?",confirmText:"예",cancelText:"아니오"})?window.location.href="/openMarket/src/pages/cart/":window.location.href="/openMarket/";return}await L({product_id:r.id,quantity:o,check:!0}),confirm(`장바구니에 상품을 담았습니다.
장바구니 페이지로 이동하시겠습니까?`)?window.location.href="/openMarket/src/pages/cart/":window.location.href="/openMarket/"}catch{alert("문제가 발생했습니다. 다시 시도해 주세요.")}}function u(t){return new Intl.NumberFormat("ko-KR").format(t)}
