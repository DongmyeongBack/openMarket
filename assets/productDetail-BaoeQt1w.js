import"./common-D2-4OkSc.js";import{r as g}from"./api-DvCEykNh.js";import{H as w,F as B,s as L,a as v}from"./Footer-DoNwG6sW.js";const p=document.getElementById("productImage"),P=document.getElementById("sellerName"),T=document.getElementById("productName"),_=document.getElementById("productPrice"),q=document.getElementById("shippingInfo"),a=document.getElementById("minusBtn"),s=document.getElementById("plusBtn"),h=document.getElementById("quantity"),E=document.getElementById("totalQuantity"),k=document.getElementById("totalPrice"),c=document.querySelector(".buy"),i=document.querySelector(".cart"),f=document.querySelectorAll(".tab");let o=null,n=1;document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search).get("productId");if(!e){alert("잘못된 접근입니다."),history.back();return}const r=document.querySelector("#header");r&&new w(r);const d=document.querySelector("#footer");d&&new B(d),N(e)});async function N(t){try{const e=await g(`/products/${t}/`,{method:"GET"});o=e,M(e),O()}catch(e){console.error("Error loading product:",e),alert("상품 정보를 불러오는 데 실패했습니다.")}}function M(t){console.log(t);const{image:e,name:r,price:d,seller:m,shipping_method:C,shipping_fee:y,stock:b}=t;p.src=e,p.alt=r,P.textContent=m.store_name||m.name,T.textContent=r,_.textContent=u(d);const x=C==="PARCEL"?"택배배송":"직접배송",S=y===0?"무료배송":`${u(y)}원`;q.textContent=`${x} / ${S}`,b===0?A():l(),D()}function D(){localStorage.getItem("userType")==="SELLER"&&(c.disabled=!0,i.disabled=!0,a.disabled=!0,s.disabled=!0,c.style.backgroundColor="#ccc",c.textContent="판매자 구매 불가",c.style.cursor="not-allowed",i.style.backgroundColor="#eee",i.style.cursor="not-allowed",a.style.opacity="0.3",s.style.opacity="0.3")}function O(){!o||o.stock===0||(a.addEventListener("click",()=>{n>1&&(n--,l())}),s.addEventListener("click",()=>{n<o.stock?(n++,l()):alert("최대 구매 가능 수량입니다.")}),c.addEventListener("click",()=>{if(!I())return;const t={type:"direct_order",items:[{product_id:o.id,product_name:o.name,quantity:n,price:o.price,shipping_fee:o.shipping_fee,image:o.image,store_name:o.seller.store_name}]};localStorage.setItem("order_data",JSON.stringify(t)),window.location.href="/src/pages/payment/index.html"}),i.addEventListener("click",R),f.forEach(t=>{t.addEventListener("click",e=>{f.forEach(r=>r.classList.remove("active")),e.target.classList.add("active")})}))}function I(){return localStorage.getItem("token")?!0:(L(),!1)}function l(){const t=o.stock;h.textContent=n,E.textContent=n;const e=o.price*n;k.textContent=u(e),a.disabled=n<=1,a.style.opacity=n<=1?"0.3":"1";const r=n>=t;s.disabled=r,s.style.opacity=r?"0.3":"1"}function A(){n=0,h.textContent="0",E.textContent="0",k.textContent="0",c.textContent="품절",c.disabled=!0,i.disabled=!0,a.disabled=!0,s.disabled=!0}async function R(){if(I())try{await g("/cart/",{method:"POST",body:JSON.stringify({product_id:o.id,quantity:n,check:!0})}),confirm(`장바구니에 상품을 담았습니다.
장바구니 페이지로 이동하시겠습니까?`)&&(window.location.href="/src/pages/cart/index.html")}catch(t){console.error("장바구니 추가 실패:",t),v()}}function u(t){return new Intl.NumberFormat("ko-KR").format(t)}
