import{c as N,a as C,s as y}from"./api-BW4WmqIz.js";import{a as k}from"./Modal-paOObtiz.js";const e={username:document.getElementById("username"),checkIdBtn:document.getElementById("checkIdBtn"),password:document.getElementById("password"),passwordConfirm:document.getElementById("passwordConfirm"),name:document.getElementById("name"),phonePrefix:document.getElementById("phonePrefix"),phoneMiddle:document.getElementById("phoneMiddle"),phoneLast:document.getElementById("phoneLast"),businessNo:document.getElementById("businessNo"),checkBusinessBtn:document.getElementById("checkBusinessBtn"),storeName:document.getElementById("storeName")},v=document.getElementById("agreeTerms"),m=document.getElementById("submitBtn"),p=document.getElementById("sellerFields"),g=document.querySelectorAll(".tab-btn");let f="BUYER";const a={username:!1,usernameChecked:!1,password:!1,passwordConfirm:!1,name:!1,phone:!1,businessNo:!1,businessChecked:!1,storeName:!1};g.forEach(s=>{s.addEventListener("click",r=>{const t=r.target.dataset.type;B(t)})});function B(s){f=s.toUpperCase(),g.forEach(r=>{r.dataset.type===s?r.classList.add("active"):r.classList.remove("active")}),f==="SELLER"?p.classList.remove("hidden"):(p.classList.add("hidden"),i(e.businessNo),i(e.storeName)),d()}function o(s,r){const t=s.closest(".input-group")||s.parentElement;let n=t.querySelector(".error-msg");n||(n=document.createElement("p"),n.className="error-msg",t.appendChild(n)),s.classList.add("error"),n.textContent=r,n.classList.remove("hidden","success"),n.classList.add("show")}function w(s,r){const t=s.closest(".input-group")||s.parentElement;let n=t.querySelector(".error-msg");n||(n=document.createElement("p"),n.className="error-msg",t.appendChild(n)),s.classList.remove("error"),n.textContent=r,n.classList.remove("hidden"),n.classList.add("show","success")}function i(s){const t=(s.closest(".input-group")||s.parentElement).querySelector(".error-msg");s.classList.remove("error"),t&&(t.classList.add("hidden"),t.classList.remove("show"),t.textContent="")}function l(s,r){const t=s.closest(".input-wrapper");t&&(r?t.classList.add("valid"):t.classList.remove("valid"))}const h=["username","password","passwordConfirm","name","phoneMiddle"];h.forEach((s,r)=>{r!==0&&e[s].addEventListener("focus",()=>{const t=e[h[r-1]];t.value.trim()||(o(t,"필수 정보입니다."),t.focus())})});e.username.addEventListener("blur",E);e.username.addEventListener("input",()=>{a.usernameChecked=!1,a.username=!1,i(e.username),d()});e.checkIdBtn.addEventListener("click",async()=>{E()&&await I()});function E(){const s=e.username.value.trim(),r=/^[A-Za-z0-9]+$/;return s?!r.test(s)||s.length>20?(o(e.username,"20자 이내의 영문 소문자, 대문자, 숫자만 사용 가능합니다."),a.username=!1,!1):(i(e.username),!0):(o(e.username,"필수 정보입니다."),a.username=!1,!1)}async function I(){const s=e.username.value.trim();try{await N(s),w(e.username,"멋진 아이디네요 :)"),a.username=!0,a.usernameChecked=!0}catch(r){let t="이미 사용 중인 아이디입니다.";r.data&&(t=r.data.error||r.data.FAIL_Message||r.data.username&&r.data.username[0]||t),o(e.username,t),a.username=!1,a.usernameChecked=!1}d()}e.password.addEventListener("input",L);e.password.addEventListener("blur",L);function L(){const s=e.password.value;if(!s){o(e.password,"필수 정보입니다."),l(e.password,!1);return}s.length<8?(o(e.password,"비밀번호는 8자 이상이어야 합니다."),l(e.password,!1),a.password=!1):/[a-z]/.test(s)?/[0-9]/.test(s)?(i(e.password),l(e.password,!0),a.password=!0):(o(e.password,"비밀번호는 한개 이상의 숫자가 필수적으로 들어가야 합니다."),l(e.password,!1),a.password=!1):(o(e.password,"비밀번호는 한개 이상의 영소문자가 필수적으로 들어가야 합니다."),l(e.password,!1),a.password=!1),e.passwordConfirm.value&&b(),d()}e.passwordConfirm.addEventListener("input",b);function b(){e.password.value!==e.passwordConfirm.value?(o(e.passwordConfirm,"비밀번호가 일치하지 않습니다."),l(e.passwordConfirm,!1),a.passwordConfirm=!1):(i(e.passwordConfirm),l(e.passwordConfirm,!0),a.passwordConfirm=!0),d()}e.name.addEventListener("blur",()=>{e.name.value.trim()?(i(e.name),a.name=!0):(o(e.name,"필수 정보입니다."),a.name=!1),d()});e.name.addEventListener("input",()=>{e.name.value.trim()&&(a.name=!0),d()});[e.phoneMiddle,e.phoneLast].forEach(s=>{s.addEventListener("input",r=>{r.target.value=r.target.value.replace(/[^0-9]/g,""),M()})});function M(){e.phoneMiddle.value.length>=3&&e.phoneLast.value.length===4?(i(e.phoneMiddle),a.phone=!0):a.phone=!1,d()}v.addEventListener("change",d);e.businessNo.addEventListener("input",s=>{s.target.value=s.target.value.replace(/[^0-9]/g,""),a.businessChecked=!1,a.businessNo=!1,i(e.businessNo),d()});e.checkBusinessBtn.addEventListener("click",async()=>{const s=e.businessNo.value.trim();if(!s){o(e.businessNo,"사업자 등록번호를 입력해주세요."),a.businessNo=!1,a.businessChecked=!1,d();return}try{const r=await C(s);w(e.businessNo,r.message||"사용 가능한 사업자등록번호입니다."),a.businessNo=!0,a.businessChecked=!0}catch(r){let t="사업자 번호 확인 중 오류가 발생했습니다.";r.data&&r.data.error?t=r.data.error:r.message&&(t=r.message),o(e.businessNo,t),a.businessNo=!1,a.businessChecked=!1}d()});e.storeName.addEventListener("blur",()=>{e.storeName.value.trim()?(i(e.storeName),a.storeName=!0):(o(e.storeName,"필수 정보입니다."),a.storeName=!1),d()});e.storeName.addEventListener("input",()=>{e.storeName.value.trim()&&(a.storeName=!0),d()});function d(){let s=a.username&&a.usernameChecked&&a.password&&a.passwordConfirm&&a.name&&a.phone&&v.checked;f==="SELLER"&&(s=s&&a.businessChecked&&a.storeName),s?(m.disabled=!1,m.classList.add("active")):(m.disabled=!0,m.classList.remove("active"))}m.addEventListener("click",async s=>{s.preventDefault();const r={username:e.username.value,password:e.password.value,name:e.name.value,phone_number:`${e.phonePrefix.value}${e.phoneMiddle.value}${e.phoneLast.value}`};f==="SELLER"&&(r.company_registration_number=e.businessNo.value,r.store_name=e.storeName.value);try{await y(r,f),await k(),window.location.href="/openMarket//pages/login/index.html"}catch(t){if(t.data){const n=t.data;for(const u in n){const c=n[u][0];u==="company_registration_number"?(o(e.businessNo,c),a.businessChecked=!1):u==="store_name"?o(e.storeName,c):u==="phone_number"?o(e.phoneMiddle,c):e[u]?o(e[u],c):alert(c)}d()}else alert(t.message||"회원가입 중 오류가 발생했습니다.")}});
