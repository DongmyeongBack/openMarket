import{g as x,b as B,d as L}from"./api-DOepU4-1.js";import{s as v,a as S}from"./Modal-C9nBlRzj.js";import{H as P}from"./Header-j7jg3zTl.js";import{F as T}from"./Footer-DnPTH6_A.js";const f=document.getElementById("productImage"),q=document.getElementById("sellerName"),_=document.getElementById("productName"),D=document.getElementById("productPrice"),A=document.getElementById("shippingInfo"),s=document.getElementById("minusBtn"),d=document.getElementById("plusBtn"),p=document.getElementById("quantity"),h=document.getElementById("totalQuantity"),C=document.getElementById("totalPrice"),a=document.querySelector(".buy"),i=document.querySelector(".cart"),g=document.querySelectorAll(".tab");let r=null,o=1;document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search).get("productId");if(!e){alert("잘못된 접근입니다."),history.back();return}const n=document.querySelector("#header");n&&new P(n);const c=document.querySelector("#footer");c&&new T(c),M(e)});async function M(t){try{const e=await x(t);console.log("get products/id",e),r=e,N(e),F()}catch(e){console.error("Error loading product:",e),alert("상품 정보를 불러오는 데 실패했습니다.")}}function N(t){console.log(t);const{image:e,name:n,price:c,seller:m,shipping_method:I,shipping_fee:y,stock:k}=t;f.src=e,f.alt=n,q.textContent=m.store_name||m.name,_.textContent=n,D.textContent=u(c);const w=I==="PARCEL"?"택배배송":"직접배송",b=y===0?"무료배송":`${u(y)}원`;A.textContent=`${w} / ${b}`,k===0?O():l(),R()}function R(){localStorage.getItem("userType")==="SELLER"&&(a.disabled=!0,i.disabled=!0,s.disabled=!0,d.disabled=!0,a.style.backgroundColor="#ccc",a.textContent="판매자 구매 불가",a.style.cursor="not-allowed",i.style.backgroundColor="#eee",i.style.cursor="not-allowed",s.style.opacity="0.3",d.style.opacity="0.3")}function F(){!r||r.stock===0||(s.addEventListener("click",()=>{o>1&&(o--,l())}),d.addEventListener("click",()=>{o<r.stock?(o++,l()):alert("최대 구매 가능 수량입니다.")}),a.addEventListener("click",()=>{if(!E())return;const t={order_kind:"direct_order",product_id:r.id,quantity:o};localStorage.setItem("order_data",JSON.stringify(t)),window.location.href="/src/pages/payment/index.html"}),i.addEventListener("click",Q),g.forEach(t=>{t.addEventListener("click",e=>{g.forEach(n=>n.classList.remove("active")),e.target.classList.add("active")})}))}function E(){return localStorage.getItem("token")?!0:(v(),!1)}function l(){const t=r.stock;p.textContent=o,h.textContent=o;const e=r.price*o;C.textContent=u(e),s.disabled=o<=1,s.style.opacity=o<=1?"0.3":"1";const n=o>=t;d.disabled=n,d.style.opacity=n?"0.3":"1"}function O(){o=0,p.textContent="0",h.textContent="0",C.textContent="0",a.textContent="품절",a.disabled=!0,i.disabled=!0,s.disabled=!0,d.disabled=!0}async function Q(){if(E())try{const t=await B();if(console.log(t.results[0]),console.log(r.id),t.results.some(c=>c.product.id===r.id)){await S()&&(window.location.href="/src/pages/cart/index.html");return}await L({product_id:r.id,quantity:o,check:!0}),confirm(`장바구니에 상품을 담았습니다.
장바구니 페이지로 이동하시겠습니까?`)&&(window.location.href="/src/pages/cart/index.html")}catch(t){console.error("장바구니 처리 중 오류:",t),alert("문제가 발생했습니다. 다시 시도해 주세요.")}}function u(t){return new Intl.NumberFormat("ko-KR").format(t)}
