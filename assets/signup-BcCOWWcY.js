import"./common-D2-4OkSc.js";import{r as p}from"./api-DvCEykNh.js";const e={username:document.getElementById("username"),checkIdBtn:document.getElementById("checkIdBtn"),password:document.getElementById("password"),passwordConfirm:document.getElementById("passwordConfirm"),name:document.getElementById("name"),phonePrefix:document.getElementById("phonePrefix"),phoneMiddle:document.getElementById("phoneMiddle"),phoneLast:document.getElementById("phoneLast"),businessNo:document.getElementById("businessNo"),checkBusinessBtn:document.getElementById("checkBusinessBtn"),storeName:document.getElementById("storeName")},w=document.getElementById("agreeTerms"),c=document.getElementById("submitBtn"),v=document.getElementById("sellerFields"),E=document.querySelectorAll(".tab-btn");let f="BUYER";const t={username:!1,usernameChecked:!1,password:!1,passwordConfirm:!1,name:!1,phone:!1,businessNo:!1,businessChecked:!1,storeName:!1};E.forEach(s=>{s.addEventListener("click",a=>{const r=a.target.dataset.type;C(r)})});function C(s){f=s.toUpperCase(),E.forEach(a=>{a.dataset.type===s?a.classList.add("active"):a.classList.remove("active")}),f==="SELLER"?v.classList.remove("hidden"):(v.classList.add("hidden"),d(e.businessNo),d(e.storeName)),i()}function o(s,a){const r=s.closest(".input-group")||s.parentElement;let n=r.querySelector(".error-msg");n||(n=document.createElement("p"),n.className="error-msg",r.appendChild(n)),s.classList.add("error"),n.textContent=a,n.classList.remove("hidden","success"),n.classList.add("show")}function L(s,a){const r=s.closest(".input-group")||s.parentElement;let n=r.querySelector(".error-msg");n||(n=document.createElement("p"),n.className="error-msg",r.appendChild(n)),s.classList.remove("error"),n.textContent=a,n.classList.remove("hidden"),n.classList.add("show","success")}function d(s){const r=(s.closest(".input-group")||s.parentElement).querySelector(".error-msg");s.classList.remove("error"),r&&(r.classList.add("hidden"),r.classList.remove("show"),r.textContent="")}function l(s,a){const r=s.closest(".input-wrapper");r&&(a?r.classList.add("valid"):r.classList.remove("valid"))}const g=["username","password","passwordConfirm","name","phoneMiddle"];g.forEach((s,a)=>{a!==0&&e[s].addEventListener("focus",()=>{const r=e[g[a-1]];r.value.trim()||(o(r,"필수 정보입니다."),r.focus())})});e.username.addEventListener("blur",b);e.username.addEventListener("input",()=>{t.usernameChecked=!1,t.username=!1,d(e.username),i()});e.checkIdBtn.addEventListener("click",async()=>{b()&&await B()});function b(){const s=e.username.value.trim(),a=/^[A-Za-z0-9]+$/;return s?!a.test(s)||s.length>20?(o(e.username,"20자 이내의 영문 소문자, 대문자, 숫자만 사용 가능합니다."),t.username=!1,!1):(d(e.username),!0):(o(e.username,"필수 정보입니다."),t.username=!1,!1)}async function B(){const s=e.username.value.trim();try{await p("/accounts/validate-username/",{method:"POST",body:JSON.stringify({username:s})}),L(e.username,"멋진 아이디네요 :)"),t.username=!0,t.usernameChecked=!0}catch(a){let r="이미 사용 중인 아이디입니다.";a.data&&(r=a.data.FAIL_Message||a.data.username&&a.data.username[0]||r),o(e.username,r),t.username=!1,t.usernameChecked=!1}i()}e.password.addEventListener("input",y);e.password.addEventListener("blur",y);function y(){const s=e.password.value;if(!s){o(e.password,"필수 정보입니다."),l(e.password,!1);return}s.length<8?(o(e.password,"비밀번호는 8자 이상이어야 합니다."),l(e.password,!1),t.password=!1):/[a-z]/.test(s)?/[0-9]/.test(s)?(d(e.password),l(e.password,!0),t.password=!0):(o(e.password,"비밀번호는 한개 이상의 숫자가 필수적으로 들어가야 합니다."),l(e.password,!1),t.password=!1):(o(e.password,"비밀번호는 한개 이상의 영소문자가 필수적으로 들어가야 합니다."),l(e.password,!1),t.password=!1),e.passwordConfirm.value&&N(),i()}e.passwordConfirm.addEventListener("input",N);function N(){e.password.value!==e.passwordConfirm.value?(o(e.passwordConfirm,"비밀번호가 일치하지 않습니다."),l(e.passwordConfirm,!1),t.passwordConfirm=!1):(d(e.passwordConfirm),l(e.passwordConfirm,!0),t.passwordConfirm=!0),i()}e.name.addEventListener("blur",()=>{e.name.value.trim()?(d(e.name),t.name=!0):(o(e.name,"필수 정보입니다."),t.name=!1),i()});e.name.addEventListener("input",()=>{e.name.value.trim()&&(t.name=!0),i()});[e.phoneMiddle,e.phoneLast].forEach(s=>{s.addEventListener("input",a=>{a.target.value=a.target.value.replace(/[^0-9]/g,""),k()})});function k(){e.phoneMiddle.value.length>=3&&e.phoneLast.value.length===4?(d(e.phoneMiddle),t.phone=!0):t.phone=!1,i()}w.addEventListener("change",i);e.businessNo.addEventListener("input",s=>{s.target.value=s.target.value.replace(/[^0-9]/g,""),t.businessChecked=!1,t.businessNo=!1,d(e.businessNo),i()});e.checkBusinessBtn.addEventListener("click",async()=>{const s=e.businessNo.value.trim();if(!s){o(e.businessNo,"사업자 등록번호를 입력해주세요."),t.businessNo=!1,t.businessChecked=!1,i();return}try{const a=await p("/accounts/seller/validate-registration-number/",{method:"POST",body:JSON.stringify({company_registration_number:s})});L(e.businessNo,a.message||"사용 가능한 사업자등록번호입니다."),t.businessNo=!0,t.businessChecked=!0}catch(a){console.error("Business No Check Error:",a);let r="사업자 번호 확인 중 오류가 발생했습니다.";a.data&&a.data.error?r=a.data.error:a.message&&(r=a.message),o(e.businessNo,r),t.businessNo=!1,t.businessChecked=!1}i()});e.storeName.addEventListener("blur",()=>{e.storeName.value.trim()?(d(e.storeName),t.storeName=!0):(o(e.storeName,"필수 정보입니다."),t.storeName=!1),i()});e.storeName.addEventListener("input",()=>{e.storeName.value.trim()&&(t.storeName=!0),i()});function i(){let s=t.username&&t.usernameChecked&&t.password&&t.passwordConfirm&&t.name&&t.phone&&w.checked;f==="SELLER"&&(s=s&&t.businessChecked&&t.storeName),s?(c.disabled=!1,c.classList.add("active")):(c.disabled=!0,c.classList.remove("active"))}c.addEventListener("click",async s=>{s.preventDefault();const a={username:e.username.value,password:e.password.value,name:e.name.value,phone_number:`${e.phonePrefix.value}${e.phoneMiddle.value}${e.phoneLast.value}`};let r="/accounts/buyer/signup/";f==="SELLER"?(r="/accounts/seller/signup/",a.company_registration_number=e.businessNo.value,a.store_name=e.storeName.value):a.user_type="BUYER";try{await p(r,{method:"POST",body:JSON.stringify(a)}),alert("회원가입이 완료되었습니다!"),window.location.href="/login.html"}catch(n){if(console.error("Signup Error:",n),n.data){const h=n.data;for(const u in h){const m=h[u][0];u==="company_registration_number"?(o(e.businessNo,m),t.businessChecked=!1):u==="store_name"?o(e.storeName,m):u==="phone_number"?o(e.phoneMiddle,m):e[u]?o(e[u],m):alert(m)}i()}else alert(n.message||"회원가입 중 오류가 발생했습니다.")}});
